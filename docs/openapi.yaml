openapi: 3.0.3
info:
  title: File Conversion Utility API
  version: 1.0.0
  summary: Comprehensive file conversion utility for internal use
  description: |
    This API provides file conversion capabilities for documents and images with enhanced accuracy features.

    **Key Features:**
    - **Pure Node.js**: No external software required
    - **Security**: Rate limiting, CORS, CSP headers, input validation
    - **Performance**: Concurrency control, request queuing, efficient processing
    - **Formats**: Support for document and image format conversions
    - **Enhanced Accuracy**: Advanced conversion accuracy with formatting preservation

    **Security Features:**
    - Rate limiting and request throttling
    - CORS configuration for controlled access
    - Content Security Policy headers
    - File type validation and security scanning

    **Production Ready:**
    - Structured logging with request tracking
    - Comprehensive error handling
    - Health monitoring endpoints
    - Serverless deployment support
    - Intranet deployment optimized

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://api.example.com/api
    description: Production server

tags:
  - name: Health
    description: System health and status endpoints
  - name: Conversion
    description: File conversion operations
  - name: Formats
    description: Supported format information

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns the current health status of the API server
      operationId: getHealth
      responses:
        "200":
          description: Server is healthy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"
              example:
                status: "healthy"
                timestamp: "2024-01-15T10:30:00.000Z"
                uptime: 3600.5
                version: "1.0.0"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /supported-formats:
    get:
      tags:
        - Formats
      summary: Get supported formats
      description: Returns all supported file formats and their available conversions
      operationId: getSupportedFormats
      responses:
        "200":
          description: List of supported formats and conversions
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SupportedFormatsResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /convert:
    post:
      tags:
        - Conversion
      summary: Convert file
      description: |
        Convert a file from one format to another with enhanced accuracy features.

        ## Supported Conversions

        ### Documents
        - PDF <-> DOCX, PDF -> TXT
        - XLSX <-> CSV, XLSX -> PDF
        - TXT -> PDF/DOCX
        - XML -> PDF
        - PPTX -> PDF

        ### Images
        - JPG/PNG/GIF/BMP/TIFF/SVG/PSD conversions
        - High-quality processing using Sharp library

        ### Enhanced Accuracy Features
        - Advanced PDF to DOCX conversion with structure preservation
        - Document formatting validation and accuracy metrics
        - Conversion quality assessment and reporting

      operationId: convertFile
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/ConvertRequest"
            encoding:
              file:
                contentType:
                  - application/pdf
                  - application/vnd.openxmlformats-officedocument.wordprocessingml.document
                  - application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                  - application/vnd.openxmlformats-officedocument.presentationml.presentation
                  - text/plain

                  - text/csv
                  - application/xml
                  - text/xml
                  - image/jpeg
                  - image/png
                  - image/gif
                  - image/bmp
                  - image/tiff
                  - image/svg+xml
                  - image/vnd.adobe.photoshop
      responses:
        "200":
          description: File converted successfully
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              schema:
                type: string
              example: 'attachment; filename="converted-file.pdf"'
        "400":
          description: Bad request - invalid file or missing parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                no_file:
                  summary: No file uploaded
                  value:
                    error: "No file uploaded"
                    message: "Please provide a file to convert"
                no_format:
                  summary: Missing target format
                  value:
                    error: "Missing target format"
                    message: "Please specify the target format for conversion"
                unsupported_type:
                  summary: Unsupported file type
                  value:
                    error: "Unsupported file type"
                    message: "File type 'xyz' is not supported"
        "413":
          description: File too large
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "File too large"
                message: "File size exceeds the limit of 50mb"
        "500":
          description: Conversion failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "Conversion failed"
                message: "Unable to convert file due to internal error"

components:
  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - timestamp
        - uptime
        - version
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
          description: Current health status of the server
        timestamp:
          type: string
          format: date-time
          description: Current server timestamp in ISO 8601 format
        uptime:
          type: number
          description: Server uptime in seconds
        version:
          type: string
          description: API version
      example:
        status: "healthy"
        timestamp: "2024-01-15T10:30:00.000Z"
        uptime: 3600.5
        version: "1.0.0"

    SupportedFormatsResponse:
      type: object
      required:
        - documents
        - images
        - system
      properties:
        documents:
          $ref: "#/components/schemas/FormatCategory"
        images:
          $ref: "#/components/schemas/FormatCategory"
        system:
          $ref: "#/components/schemas/SystemInfo"

    FormatCategory:
      type: object
      required:
        - input
        - conversions
      properties:
        input:
          type: array
          items:
            type: string
          description: List of supported input formats
        conversions:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          description: Map of input formats to their supported output formats
        notes:
          type: object
          additionalProperties:
            type: string
          description: Additional notes about format support

    SystemInfo:
      type: object
      properties:
        approach:
          type: string
          description: Technical approach used
        benefits:
          type: array
          items:
            type: string
          description: List of system benefits
        limitations:
          type: array
          items:
            type: string
          description: List of current limitations
        accuracy:
          type: object
          description: Enhanced accuracy features
          properties:
            features:
              type: array
              items:
                type: string
              description: List of accuracy enhancement features
            validation:
              type: array
              items:
                type: string
              description: List of validation capabilities

    ConvertRequest:
      type: object
      required:
        - file
        - targetFormat
      properties:
        file:
          type: string
          format: binary
          description: The file to be converted
        targetFormat:
          type: string
          description: Target format for conversion
          enum:
            # Document formats
            - pdf
            - docx
            - txt

            - csv
            - xlsx
            # Image formats
            - jpg
            - jpeg
            - png
            - gif
            - bmp
            - tiff
            - svg

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error type or category
        message:
          type: string
          description: Human-readable error message
        details:
          type: string
          description: Additional error details (development mode only)
      example:
        error: "Conversion failed"
        message: "Unable to process the uploaded file"

  # Note: No security schemes are defined because an API key is not required.
